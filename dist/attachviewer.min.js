"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),AttachViewer=function(){function e(t){var n=this,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,e);var o=this;return this.opts=Object.assign({name:"attachviewer",domain:"localhost",showPrevNext:!0,prev:"〈",next:"〉",close:"╳",download:"⇓",show:"⤢",closeOnShow:!0,closeOnDownload:!0,unknownPreview:!0,unknownCaption:"Скачать файл",unknownTitle:"Предварительный просмотр недоступен",closable:!1},a),this.container=crEl("div",{c:"attachviewer"}),t&&t.length&&!function(){var e=function(e,t){return crEl("div",{c:"attachviewer-item",d:{name:e.dataset.name||e.innerHTML,url:e.href,showUrl:e.dataset.showUrl||"",downloadUrl:e.dataset.downloadUrl||""}})};n.toolbar=crEl("div",{c:"attachviewer-subtoolbar"}),n.toolbar.onclick=function(e){return e.preventDefault(),!1},n.title=crEl("span",{c:"attachviewer-title"}),n.downloadBtn=crEl("a",{},o.opts.download),n.showBtn=crEl("a",{},o.opts.show),n.container.dataset.length=t.length,t.forEach(function(t,a){t.addEventListener("click",function(e){return e.preventDefault(),o.open(a),!1}),n.container.appendChild(new e(t,a))}),n.opts.showPrevNext&&t.length>1&&(n.container.appendChild(crEl("button",{c:"attachviewer-prev",e:{click:function(e){return e.preventDefault(),o.prev(),!1}}},n.opts.prev)),n.container.appendChild(crEl("button",{c:"attachviewer-next",e:{click:function(e){return e.preventDefault(),o.next(),!1}}},n.opts.next))),n.toolbar.appendChild(n.downloadBtn),n.toolbar.appendChild(n.showBtn),n.container.onclick=function(e){return e.target===this&&o.opts.closable&&o.close(),!1},n.container.appendChild(crEl("div",{c:"attachviewer-toolbar"},crEl("button",{c:"attachviewer-close",e:{click:function(){o.close()}}},o.opts.close),o.toolbar,o.title))}(),document.body.appendChild(this.container),window.addEventListener("keydown",function(e){o.container.classList.contains("active")&&(27===e.keyCode&&o.close(),37===e.keyCode&&o.prev(),39===e.keyCode&&o.next())}),this.container.focus(),this}return _createClass(e,[{key:"close",value:function(){this.container.classList.remove("active")}},{key:"open",value:function(e){var t=this;this.container.classList.add("active"),this.container.querySelector(".active")&&this.container.querySelector(".active").classList.remove("active");var n=this.container.querySelectorAll(".attachviewer-item")[e];if(n){if(n.classList.add("active"),!n.dataset.loaded){var a=["PPT","PPTX","DOC","DOCX","XLS","XLSX"],o=["WebM","MPEG4","3GPP","MOV","AVI","MPEGPS","WMV","FLV","TXT","CSS","HTML","PHP","C","CPP","H","HPP","JS","DOC","DOCX","XLS","XLSX","PPT","PPTX","PDF","PAGES","AI","PSD","TIFF","DXF","EPS","PS","TTF","XPS","ZIP","RAR"],r=["JPEG","JPG","PNG","GIF","TIFF","BMP","SVG"],i=/(?:\.([^.]+))?$/,l=i.exec(n.dataset.url)[1],s=crEl("span","X3_"+l),c=window.innerWidth-96+"px",d=window.innerHeight-96+"px";if(l)if(r.indexOf(l.toUpperCase())>=0)s=crEl("img",{src:n.dataset.url}),s.style.maxWidth=c,s.style.maxHeight=d;else if(a.indexOf(l.toUpperCase())>=0)s=crEl("iframe",{src:"https://view.officeapps.live.com/op/embed.aspx?src="+n.dataset.url,frameborder:0}),s.style.height=d,s.style.width=c;else if(o.indexOf(l.toUpperCase())>=0)s=crEl("iframe",{src:"//docs.google.com/a/"+t.opts.domain+"/viewer?url="+n.dataset.url+"&embedded=true"}),s.style.height=d,s.style.width=c;else{var h="#";if(h=n.dataset.downloadUrl&&n.dataset.downloadUrl.length?n.dataset.downloadUrl:n.dataset.url&&n.dataset.url.length?n.dataset.url:h.href,console.log(h,n),0==t.opts.unknownPreview)return location.href=h,!1;s=crEl("div",{c:"attachviewer-unknown"},crEl("h3",t.opts.unknownTitle),crEl("a",{href:h,target:"_blank",e:{click:function(){return t.close()}}},t.opts.unknownCaption)),s.onclick=function(e){return e.preventDefault(),!1}}n.appendChild(s),n.dataset.loaded=!0}t.title.innerHTML=n.dataset.name,n.dataset.downloadUrl&&n.dataset.downloadUrl.length?(t.downloadBtn.classList.add("visible"),t.downloadBtn.onclick=function(){t.opts.closeOnDownload&&t.close()},t.downloadBtn.target=n.dataset.target||"_blank",t.downloadBtn.href=n.dataset.downloadUrl):t.downloadBtn.classList.remove("visible"),n.dataset.showUrl&&n.dataset.showUrl.length?(t.showBtn.classList.add("visible"),t.showBtn.onclick=function(){t.opts.closeOnShow&&t.close()},t.showBtn.target=n.dataset.target||"_blank",t.showBtn.href=n.dataset.showUrl):t.showBtn.classList.remove("visible")}this.container.dataset.index=e}},{key:"next",value:function(){var e=+this.container.dataset.index,t=+this.container.dataset.length;e>=t-1&&(e=-1),this.open(e+1)}},{key:"prev",value:function(){var e=+this.container.dataset.index,t=+this.container.dataset.length;e<=0&&(e=t),this.open(e-1)}}]),e}();
//# sourceMappingURL=attachviewer.js.map
