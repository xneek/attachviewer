"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),AttachViewer=function(){function t(e){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t);var o=this;if(this.opts=Object.assign({name:"attachviewer",domain:"localhost",showPrevNext:!0,prev:"〈",next:"〉",close:"╳",download:"⇓",show:"⤢",closeOnShow:!0,closeOnDownload:!0,unknownPreview:!0,unknownCaption:"Скачать файл",unknownTitle:"Предварительный просмотр недоступен",closable:!1},a),this.container=crEl("div",{c:"attachviewer"}),e&&e.length){var i=function(t,e){return crEl("div",{c:"attachviewer-item",d:{name:t.dataset.name||t.innerHTML,url:t.href,showUrl:t.dataset.showUrl||"",downloadUrl:t.dataset.downloadUrl||""}})};this.toolbar=crEl("div",{c:"attachviewer-subtoolbar"}),this.title=crEl("span",{c:"attachviewer-title"}),this.downloadBtn=crEl("a",{},o.opts.download),this.showBtn=crEl("a",{},o.opts.show),this.container.dataset.length=e.length,e.forEach(function(t,e){t.addEventListener("click",function(t){return t.preventDefault(),o.open(e),!1}),n.container.appendChild(new i(t,e))}),this.opts.showPrevNext&&e.length>1&&(this.container.appendChild(crEl("button",{c:"attachviewer-prev",e:{click:function(t){return t.preventDefault(),o.prev(),!1}}},this.opts.prev)),this.container.appendChild(crEl("button",{c:"attachviewer-next",e:{click:function(t){return t.preventDefault(),o.next(),!1}}},this.opts.next))),this.toolbar.appendChild(this.downloadBtn),this.toolbar.appendChild(this.showBtn),this.container.onclick=function(t){t.target===this&&o.opts.closable&&o.close()},this.container.appendChild(crEl("div",{c:"attachviewer-toolbar"},crEl("button",{c:"attachviewer-close",e:{click:function(){o.close()}}},o.opts.close),o.toolbar,o.title))}return document.body.appendChild(this.container),window.addEventListener("keydown",function(t){return t.preventDefault(),t.stopPropagation(),o.container.classList.contains("active")&&(27===t.keyCode&&o.close(),37===t.keyCode&&o.prev(),39===t.keyCode&&o.next()),!1}),this.container.focus(),this}return _createClass(t,[{key:"close",value:function(){this.container.classList.remove("active")}},{key:"open",value:function(t){var e=this;this.container.classList.add("active"),this.container.querySelector(".active")&&this.container.querySelector(".active").classList.remove("active");var n=this.container.querySelectorAll(".attachviewer-item")[t];if(n){if(n.classList.add("active"),!n.dataset.loaded){var a=["PPT","PPTX","DOC","DOCX","XLS","XLSX"],o=["WebM","MPEG4","3GPP","MOV","AVI","MPEGPS","WMV","FLV","TXT","CSS","HTML","PHP","C","CPP","H","HPP","JS","DOC","DOCX","XLS","XLSX","PPT","PPTX","PDF","PAGES","AI","PSD","TIFF","DXF","EPS","PS","TTF","XPS","ZIP","RAR"],i=["JPEG","JPG","PNG","GIF","TIFF","BMP","SVG"],s=/(?:\.([^.]+))?$/,r=s.exec(n.dataset.url)[1],l=crEl("span","X3_"+r),c=window.innerWidth-96+"px",d=window.innerHeight-96+"px";if(r)if(i.indexOf(r.toUpperCase())>=0)l=crEl("img",{src:n.dataset.url}),l.style.maxWidth=c,l.style.maxHeight=d;else if(a.indexOf(r.toUpperCase())>=0)l=crEl("iframe",{src:"https://view.officeapps.live.com/op/embed.aspx?src="+n.dataset.url,frameborder:0}),l.style.height=d,l.style.width=c;else if(o.indexOf(r.toUpperCase())>=0)l=crEl("iframe",{src:"//docs.google.com/a/"+e.opts.domain+"/viewer?url="+n.dataset.url+"&embedded=true"}),l.style.height=d,l.style.width=c;else{var h="#";if(h=n.dataset.downloadUrl&&n.dataset.downloadUrl.length?n.dataset.downloadUrl:n.dataset.url&&n.dataset.url.length?n.dataset.url:h.href,console.log(h,n),0==e.opts.unknownPreview)return location.href=h,!1;l=crEl("div",{c:"attachviewer-unknown"},crEl("h3",e.opts.unknownTitle),crEl("a",{href:h,target:"_blank",e:{click:function(){return e.close()}}},e.opts.unknownCaption))}n.appendChild(l),n.dataset.loaded=!0}e.title.innerHTML=n.dataset.name,n.dataset.downloadUrl&&n.dataset.downloadUrl.length?(e.downloadBtn.classList.add("visible"),e.downloadBtn.target=n.dataset.target||"_blank",e.downloadBtn.href=n.dataset.downloadUrl,e.downloadBtn.onclick=function(){e.opts.closeOnDownload&&e.close()}):e.downloadBtn.classList.remove("visible"),n.dataset.showUrl&&n.dataset.showUrl.length?(e.showBtn.classList.add("visible"),e.showBtn.target=n.dataset.target||"_blank",e.showBtn.href=n.dataset.showUrl,e.showBtn.onclick=function(){e.opts.closeOnShow&&e.close()}):e.showBtn.classList.remove("visible")}this.container.dataset.index=t}},{key:"next",value:function(){var t=+this.container.dataset.index;t>=+this.container.dataset.length-1&&(t=-1),this.open(t+1)}},{key:"prev",value:function(){var t=+this.container.dataset.index,e=+this.container.dataset.length;t<=0&&(t=e),this.open(t-1)}}]),t}();
//# sourceMappingURL=attachviewer.js.map
