"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),AttachViewer=function(){function e(t){function a(e,t){var a=crEl("div",{c:"attachviewer-subtoolbar"});return e.dataset&&(e.dataset.downloadUrl&&e.dataset.downloadUrl.length&&a.appendChild(crEl("a",{target:e.dataset.target||"_blank",href:e.dataset.downloadUrl,e:{click:function(){o.opts.closeOnDownload&&o.close()}}},o.opts.download)),e.dataset.showUrl&&e.dataset.showUrl.length&&a.appendChild(crEl("a",{target:e.dataset.target||"_blank",href:e.dataset.showUrl,e:{click:function(){o.opts.closeOnShow&&o.close()}}},o.opts.show))),crEl("div",{c:"attachviewer-item",d:{url:e.href}},crEl("div",{c:"attachviewer-toolbar"},crEl("button",{c:"attachviewer-close",e:{click:function(){o.close()}}},o.opts.close),a,e.dataset.name||e.innerHTML))}var n=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,e),this.opts=Object.assign({name:"attachviewer",domain:"localhost",showPrevNext:!0,prev:"〈",next:"〉",close:"╳",download:"⇓",show:"⤢",closeOnShow:!0,closeOnDownload:!0,unknownPreview:!0,unknownCaption:"Скачать файл",unknownTitle:"Предварительный просмотр недоступен"},i);var o=this;return this.container=crEl("div",{c:"attachviewer"}),t&&t.length&&(this.container.dataset.length=t.length,t.forEach(function(e,t){e.addEventListener("click",function(e){return e.preventDefault(),o.open(t),!1}),n.container.appendChild(new a(e,t))}),this.opts.showPrevNext&&t.length>1&&(this.container.appendChild(crEl("button",{c:"attachviewer-prev",e:{click:function(){o.prev()}}},this.opts.prev)),this.container.appendChild(crEl("button",{c:"attachviewer-next",e:{click:function(){o.next()}}},this.opts.next)))),document.body.appendChild(this.container),window.addEventListener("keydown",function(e){o.container.classList.contains("active")&&(27===e.keyCode&&o.close(),37===e.keyCode&&o.prev(),39===e.keyCode&&o.next())}),this.container.focus(),this}return _createClass(e,[{key:"close",value:function(){this.container.classList.remove("active")}},{key:"open",value:function(e){var t=this;this.container.classList.add("active"),this.container.querySelector(".active")&&this.container.querySelector(".active").classList.remove("active");var a=this.container.querySelectorAll(".attachviewer-item")[e];if(a&&(a.classList.add("active"),!a.dataset.loaded)){var n=["PPT","PPTX","DOC","DOCX","XLS","XLSX"],i=["WebM","MPEG4","3GPP","MOV","AVI","MPEGPS","WMV","FLV","TXT","CSS","HTML","PHP","C","CPP","H","HPP","JS","DOC","DOCX","XLS","XLSX","PPT","PPTX","PDF","PAGES","AI","PSD","TIFF","DXF","EPS","PS","TTF","XPS","ZIP","RAR"],o=["JPEG","JPG","PNG","GIF","TIFF","BMP","SVG"],r=/(?:\.([^.]+))?$/,s=r.exec(a.dataset.url)[1],c=crEl("span","X3_"+s),l=window.innerWidth-96+"px",d=window.innerHeight-96+"px";if(s)if(o.indexOf(s.toUpperCase())>=0)c=crEl("img",{src:a.dataset.url}),c.style.maxWidth=l,c.style.maxHeight=d;else if(n.indexOf(s.toUpperCase())>=0)c=crEl("iframe",{src:"https://view.officeapps.live.com/op/embed.aspx?src="+a.dataset.url,frameborder:0}),c.style.height=d,c.style.width=l;else if(i.indexOf(s.toUpperCase())>=0)c=crEl("iframe",{src:"//docs.google.com/a/"+t.opts.domain+"/viewer?url="+a.dataset.url+"&embedded=true"}),c.style.height=d,c.style.width=l;else{var h="#";if(h=a.dataset.downloadUrl&&a.dataset.downloadUrl.length?a.dataset.downloadUrl:a.dataset.url&&a.dataset.url.length?a.dataset.url:h.href,console.log(h,a),0==t.opts.unknownPreview)return location.href=h,!1;c=crEl("div",{c:"attachviewer-unknown"},crEl("h3",t.opts.unknownTitle),crEl("a",{href:h,target:"_blank",e:{click:function(){return t.close()}}},t.opts.unknownCaption))}a.appendChild(c),a.dataset.loaded=!0}this.container.dataset.index=e}},{key:"next",value:function(){var e=+this.container.dataset.index,t=+this.container.dataset.length;e>=t-1&&(e=-1),this.open(e+1)}},{key:"prev",value:function(){var e=+this.container.dataset.index,t=+this.container.dataset.length;e<=0&&(e=t),this.open(e-1)}}]),e}();
//# sourceMappingURL=attachviewer.js.map
