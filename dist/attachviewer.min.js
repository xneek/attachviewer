"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),AttachViewer=function(){function e(t){function n(e,t){return crEl("div",{c:"attachviewer-item",d:{url:e.href}},crEl("div",{c:"attachviewer-toolbar"},crEl("button",{c:"attachviewer-close",e:{click:function(){i.close()}}},"×"),crEl("div",{c:"attachviewer-subtoolbar"},crEl("a",{target:"_blank",href:e.href,e:{click:function(){i.close()}}},"⇓")),e.dataset.name||e.innerHTML))}var a=this;_classCallCheck(this,e);var i=this;return this.domain="my-pm.ru",this.container=crEl("div",{c:"attachviewer"}),t&&t.length&&(this.container.dataset.length=t.length,t.forEach(function(e,t){e.addEventListener("click",function(e){return e.preventDefault(),i.open(t),!1}),a.container.appendChild(new n(e,t))}),t.length>1&&(this.container.appendChild(crEl("button",{c:"attachviewer-prev",e:{click:function(){i.prev()}}},"〈")),this.container.appendChild(crEl("button",{c:"attachviewer-next",e:{click:function(){i.next()}}},"〉")))),document.body.appendChild(this.container),window.addEventListener("keydown",function(e){i.container.classList.contains("active")&&(27===e.keyCode&&i.close(),37===e.keyCode&&i.prev(),39===e.keyCode&&i.next())}),this.container.focus(),this}return _createClass(e,[{key:"close",value:function(){this.container.classList.remove("active")}},{key:"open",value:function(e){console.log(e),this.container.classList.add("active"),this.container.querySelector(".active")&&this.container.querySelector(".active").classList.remove("active");var t=this.container.querySelectorAll(".attachviewer-item")[e];if(t&&(t.classList.add("active"),!t.dataset.loaded)){var n=["PPT","PPTX","DOC","DOCX","XLS","XLSX"],a=["WebM","MPEG4","3GPP","MOV","AVI","MPEGPS","WMV","FLV","TXT","CSS","HTML","PHP","C","CPP","H","HPP","JS","DOC","DOCX","XLS","XLSX","PPT","PPTX","PDF","PAGES","AI","PSD","TIFF","DXF","EPS","PS","TTF","XPS","ZIP","RAR"],i=["JPEG","JPG","PNG","GIF","TIFF","BMP","SVG"],c=/(?:\.([^.]+))?$/,r=c.exec(t.dataset.url)[1],o=crEl("span","X3_"+r),s=window.innerHeight-96+"px",l=window.innerWidth-96+"px";r&&(i.indexOf(r.toUpperCase())>=0?(o=crEl("img",{src:t.dataset.url}),o.style.maxWidth=l,o.style.maxHeight=s):n.indexOf(r.toUpperCase())>=0?(o=crEl("iframe",{src:"https://view.officeapps.live.com/op/embed.aspx?src="+t.dataset.url,frameborder:0}),o.style.height=s,o.style.width=l):a.indexOf(r.toUpperCase())>=0&&(o=crEl("iframe",{src:"https://docs.google.com/a/"+this.domain+"/viewer?url="+t.dataset.url+"&embedded=false"}))),t.appendChild(o),t.dataset.loaded=!0}this.container.dataset.index=e}},{key:"next",value:function(){var e=+this.container.dataset.index,t=+this.container.dataset.length;e>=t-1&&(e=-1),this.open(e+1)}},{key:"prev",value:function(){var e=+this.container.dataset.index,t=+this.container.dataset.length;e<=0&&(e=t),this.open(e-1)}}]),e}();
//# sourceMappingURL=attachviewer.js.map
