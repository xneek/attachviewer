"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),AttachViewer=function(){function t(e){var n=this,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,t);var o=this;return this.opts=Object.assign({name:"attachviewer",domain:"localhost",showPrevNext:!0,prev:"〈",next:"〉",close:"╳",download:"⇓",show:"⤢",closeOnShow:!0,closeOnDownload:!0,unknownPreview:!0,unknownCaption:"Скачать файл",unknownTitle:"Предварительный просмотр недоступен",closable:!1},a),this.container=crEl("div",{c:"attachviewer"}),e&&e.length&&!function(){var t=function(t,e){return crEl("div",{c:"attachviewer-item",d:{name:t.dataset.name||t.innerHTML,url:t.href,showUrl:t.dataset.showUrl||"",downloadUrl:t.dataset.downloadUrl||""}})};n.toolbar=crEl("div",{c:"attachviewer-subtoolbar"}),n.toolbar.onclick=function(t){return t.preventDefault(),!1},n.title=crEl("span",{c:"attachviewer-title"}),n.downloadBtn=crEl("a",{},o.opts.download),n.showBtn=crEl("a",{},o.opts.show),n.container.dataset.length=e.length,e.forEach(function(e,a){e.addEventListener("click",function(t){return t.preventDefault(),o.open(a),!1}),n.container.appendChild(new t(e,a))}),n.opts.showPrevNext&&e.length>1&&(n.container.appendChild(crEl("button",{c:"attachviewer-prev",e:{click:function(t){return t.preventDefault(),o.prev(),!1}}},n.opts.prev)),n.container.appendChild(crEl("button",{c:"attachviewer-next",e:{click:function(t){return t.preventDefault(),o.next(),!1}}},n.opts.next))),n.toolbar.appendChild(n.downloadBtn),n.toolbar.appendChild(n.showBtn),n.container.onclick=function(t){return t.target===this&&o.opts.closable&&o.close(),!1},n.container.appendChild(crEl("div",{c:"attachviewer-toolbar"},crEl("button",{c:"attachviewer-close",e:{click:function(){o.close()}}},o.opts.close),o.toolbar,o.title))}(),document.body.appendChild(this.container),window.addEventListener("keydown",function(t){o.container.classList.contains("active")&&(27===t.keyCode&&o.close(),37===t.keyCode&&o.prev(),39===t.keyCode&&o.next())}),this.container.focus(),this}return _createClass(t,[{key:"close",value:function(){this.container.classList.remove("active")}},{key:"open",value:function(t){var e=this;this.container.classList.add("active"),this.container.querySelector(".active")&&this.container.querySelector(".active").classList.remove("active");var n=this.container.querySelectorAll(".attachviewer-item")[t];if(n){if(n.classList.add("active"),!n.dataset.loaded){var a=["PPT","PPTX","DOC","DOCX","XLS","XLSX"],o=["WebM","MPEG4","3GPP","MOV","AVI","MPEGPS","WMV","FLV","TXT","CSS","HTML","PHP","C","CPP","H","HPP","JS","DOC","DOCX","XLS","XLSX","PPT","PPTX","PDF","PAGES","AI","PSD","TIFF","DXF","EPS","PS","TTF","XPS","ZIP","RAR"],i=["JPEG","JPG","PNG","GIF","TIFF","BMP","SVG"],r=/(?:\.([^.]+))?$/,l=r.exec(n.dataset.url)[1],s=crEl("span","X3_"+l),c=window.innerWidth-96+"px",d=window.innerHeight-96+"px";if(l)if(i.indexOf(l.toUpperCase())>=0)s=crEl("img",{src:n.dataset.url}),s.style.maxWidth=c,s.style.maxHeight=d;else if(a.indexOf(l.toUpperCase())>=0)s=crEl("iframe",{src:"https://view.officeapps.live.com/op/embed.aspx?src="+n.dataset.url,frameborder:0}),s.style.height=d,s.style.width=c;else if(o.indexOf(l.toUpperCase())>=0)s=crEl("iframe",{src:"//docs.google.com/a/"+e.opts.domain+"/viewer?url="+n.dataset.url+"&embedded=true"}),s.style.height=d,s.style.width=c;else{var h="#";if(h=n.dataset.downloadUrl&&n.dataset.downloadUrl.length?n.dataset.downloadUrl:n.dataset.url&&n.dataset.url.length?n.dataset.url:h.href,console.log(h,n),0==e.opts.unknownPreview)return location.href=h,!1;s=crEl("div",{c:"attachviewer-unknown"},crEl("h3",e.opts.unknownTitle),crEl("a",{href:h,target:"_blank",e:{click:function(){return e.close()}}},e.opts.unknownCaption)),s.onclick=function(t){return t.preventDefault(),!1}}n.appendChild(s),n.dataset.loaded=!0}e.title.innerHTML=n.dataset.name,n.dataset.downloadUrl&&n.dataset.downloadUrl.length?(e.downloadBtn.classList.add("visible"),e.downloadBtn.target=n.dataset.target||"_blank",e.downloadBtn.href=n.dataset.downloadUrl,e.downloadBtn.onclick=function(){setTimeout(function(){e.opts.closeOnDownload&&e.close()},500)}):e.downloadBtn.classList.remove("visible"),n.dataset.showUrl&&n.dataset.showUrl.length?(e.showBtn.classList.add("visible"),e.showBtn.target=n.dataset.target||"_blank",e.showBtn.href=n.dataset.showUrl,e.showBtn.onclick=function(){setTimeout(function(){e.opts.closeOnShow&&e.close()},500)}):e.showBtn.classList.remove("visible")}this.container.dataset.index=t}},{key:"next",value:function(){var t=+this.container.dataset.index,e=+this.container.dataset.length;t>=e-1&&(t=-1),this.open(t+1)}},{key:"prev",value:function(){var t=+this.container.dataset.index,e=+this.container.dataset.length;t<=0&&(t=e),this.open(t-1)}}]),t}();
//# sourceMappingURL=attachviewer.js.map
